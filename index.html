<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora IPv6 - Gerador de Sub-redes</title>
  <meta name="description" content="Ferramenta online para c√°lculo e visualiza√ß√£o de sub-redes IPv6">
  
  <!-- Favicon inline para evitar requests 404 -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>" type="image/svg+xml">
  
  <!-- Estilos CSS - Carregados antes dos scripts -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/dark-mode.css">
  <link rel="stylesheet" href="css/enhanced-ui.css">
  <link rel="stylesheet" href="css/ui-fixes.css">
  <link rel="stylesheet" href="css/network-panel.css">
  
  <!-- Font Awesome para √≠cones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Meta tag de tema -->
  <meta name="theme-color" content="#0070d1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
</head>
<body>
  <!-- Alerta de erro para mostrar problemas de inicializa√ß√£o -->
  <div id="initErrorAlert" style="display: none; background-color: #f8d7da; color: #721c24; padding: 12px; margin: 10px; border-radius: 4px; border: 1px solid #f5c6cb;">
    <strong>Erro ao inicializar:</strong> <span id="initErrorMessage"></span>
    <button onclick="window.location.reload()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; margin-left: 10px; border-radius: 3px; cursor: pointer;">Recarregar</button>
  </div>

  <div class="container">
    <!-- Cabe√ßalho -->
    <header class="header">
      <h1>Calculadora IPv6</h1>
      <div class="header-buttons">
        <!-- Bot√£o para abrir o painel de configura√ß√£o de rede -->
        <button id="networkConfigBtn" class="btn-primary">
          <i class="fas fa-network-wired"></i> Rede
        </button>
        <button id="toggleThemeBtn" class="btn-primary">
          <i class="fas fa-moon"></i> Tema
        </button>
        <button id="resetBtn" class="btn-primary">
          <i class="fas fa-redo-alt"></i> Limpar
        </button>
      </div>
    </header>
    
    <!-- Estrutura do Modal de Configura√ß√£o de Rede -->
    <div id="networkConfigModalOverlay" class="modal-overlay">
      <div id="networkConfigModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="networkConfigModalTitle">
        <div class="modal-header">
          <h3 id="networkConfigModalTitle">Configura√ß√£o de Rede</h3>
          <button id="closeNetworkConfigModalBtn" class="modal-close-btn" aria-label="Fechar">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p>Configure seus prefixos IPv6 para WAN e LAN.</p>
          
          <div class="field-group">
            <label for="modalWanPrefix">Prefixo WAN (CIDR):</label>
            <input type="text" id="modalWanPrefix" value="2804:418:3000:1::190/64" placeholder="Ex.: 2001:db8::/64" autocomplete="off">
            <div class="field-hint">Endere√ßo IPv6 da interface WAN no formato CIDR.</div>
          </div>
          
          <div class="field-group">
            <label for="modalLanPrefix">Prefixo LAN (CIDR):</label>
            <input type="text" id="modalLanPrefix" value="2804:418:3000:5::1/64" placeholder="Ex.: 2001:db8:1::/64" autocomplete="off">
            <div class="field-hint">Endere√ßo IPv6 da interface LAN no formato CIDR (usado para refer√™ncia, o principal √© o campo da tela inicial).</div>
          </div>
          
          <button id="modalResolveConflictBtn" class="btn-primary">
            <i class="fas fa-magic"></i> Verificar Sobreposi√ß√£o
          </button>
          
          <!-- √Årea para mostrar mensagens de sobreposi√ß√£o -->
          <div id="modalOverlapWarning" class="overlap-warning" style="display: none; margin-top: 20px;">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-content">
              <h4>Sobreposi√ß√£o de blocos IPv6 detectada!</h4>
              <p>Os prefixos WAN e LAN est√£o em conflito.</p>
              <div class="suggested-prefix">
                <code id="modalSuggestedPrefix">-</code>
                <button id="modalApplyPrefixBtn" class="btn-primary">
                  <i class="fas fa-check"></i> Aplicar Sugest√£o (no campo principal)
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
            <button id="saveNetworkConfigBtn" class="btn-primary">
                <i class="fas fa-save"></i> Salvar Configura√ß√£o
            </button>
            <button id="cancelNetworkConfigBtn" class="btn-secondary">
                Cancelar
            </button>
        </div>
      </div>
    </div>
    
    <!-- Indicador de passos -->
    <div class="steps">
      <div id="step1" class="step active">
        <div class="step-number">1</div>
        <div class="step-title">Inserir IPv6</div>
      </div>
      <div id="step2" class="step">
        <div class="step-number">2</div>
        <div class="step-title">Escolher Prefixo</div>
      </div>
      <div id="step3" class="step">
        <div class="step-number">3</div>
        <div class="step-title">Gerenciar Sub-redes</div>
      </div>
    </div>
    
    <!-- Layout principal -->
    <div class="main-layout">
      <div class="content">
        <!-- Formul√°rio inicial -->
        <div class="form-group">
          <label for="ipv6">Insira um endere√ßo IPv6 no formato CIDR:</label>
          <input type="text" id="ipv6" 
                 placeholder="Ex.: 2001:db8::/41" 
                 autocomplete="off" 
                 aria-describedby="errorMessage">
          <div id="errorMessage" class="error-message"></div>
          
          <div class="action-buttons">
            <button id="calcularBtn" class="btn-primary">
              <i class="fas fa-calculator"></i> Calcular Sub-redes
            </button>
          </div>
        </div>
        
        <!-- Bloco principal simplificado -->
        <div id="mainBlockSection" style="display: none;">
          <div class="card">
            <h3>Bloco IPv6 Principal</h3>
            <div class="info-item">
              <span class="info-label">CIDR:</span>
              <div class="info-value-container">
                <div id="mainBlockCidr" class="info-value">-</div>
                <button class="copy-btn" onclick="UIController.copiarTexto('mainBlockCidr')">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
            <div class="action-buttons">
              <button id="toggleMainBlockIpsBtn" class="btn-primary">
                <i class="fas fa-list"></i> Exibir IPs
              </button>
              <button id="continuarBtn" class="btn-secondary">
                <i class="fas fa-angle-right"></i> Escolher Prefixo
              </button>
            </div>
            
            <!-- Lista de IPs do bloco principal -->
            <div id="mainBlockIpsContainer" style="display: none;">
              <h4>Primeiros IPs dispon√≠veis neste bloco:</h4>
              <ul id="mainBlockIpsList" class="ip-list"></ul>
              <div class="action-buttons">
                <button id="moreMainBlockIpsBtn" class="btn-primary">
                  <i class="fas fa-plus"></i> Gerar Mais 50 IPs
                </button>
                <button id="resetMainBlockIPsButton" class="btn-secondary">
                  <i class="fas fa-redo-alt"></i> Resetar Lista
                </button>
                <button id="exportMainBlockIpsBtn" class="btn-secondary" style="display: none;">
                  <i class="fas fa-file-excel"></i> Exportar IPs
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Sugest√µes de divis√£o -->
        <div id="suggestions" style="display: none;">
          <div class="card">
            <h3>Escolha um Prefixo para Divis√£o</h3>
            <p>Selecione o tamanho do prefixo para dividir o bloco em sub-redes:</p>
            <div id="possiblePrefixesList" class="prefixes-list"></div>
          </div>
        </div>
        
        <!-- Resultados -->
        <div id="resultado" style="display: none;">
          <div class="card">
            <h3>Sub-redes Geradas</h3>
            <div class="table-container">
              <table id="subnetsTable">
                <thead>
                  <tr>
                    <th width="50">
                      <input type="checkbox" id="selectAll" aria-label="Selecionar todas as sub-redes">
                    </th>
                    <th>Sub-rede</th>
                    <th>Inicial</th>
                    <th>Final</th>
                    <th>Rede</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            
            <div id="loadMoreContainer" style="display: none; text-align: center; margin-top: 16px;">
              <button id="loadMoreButton" class="btn-primary">
                <i class="fas fa-sync"></i> Carregar Mais Sub-redes
              </button>
            </div>
            
            <div class="action-buttons">
              <button id="gerarIPsButton" class="btn-primary" style="display: none;">
                <i class="fas fa-list"></i> Gerar IPs da Sub-rede
              </button>
              <button id="exportSubnetsTableBtn" class="btn-secondary" style="display: none;">
                  <i class="fas fa-file-excel"></i> Exportar Tabela
              </button>
            </div>
          </div>
        </div>
        
        <!-- Lista de IPs da sub-rede selecionada -->
        <div id="ipsResult" style="display: none;">
          <div class="card">
            <h3>IPs da Sub-rede Selecionada</h3>
            <ul id="ipsList" class="ip-list"></ul>
            <div class="action-buttons">
              <button id="gerarMaisIPsButton" class="btn-primary">
                <i class="fas fa-plus"></i> Gerar Mais 50 IPs
              </button>
              <button id="resetIPsButton" class="btn-secondary">
                <i class="fas fa-redo-alt"></i> Resetar Lista
              </button>
              <button id="exportSubnetIpsBtn" class="btn-secondary" style="display: none;">
                <i class="fas fa-file-excel"></i> Exportar IPs
              </button>
            </div>
          </div>
        </div>
        
        <!-- Indicador de carregamento -->
        <div id="loadingIndicator" class="loader-container" style="display: none;">
          <div class="loader"></div>
          <div class="loading-message">Gerando sub-redes... Por favor, aguarde.</div>
        </div>
      </div>
      
      <!-- Sidebar para informa√ß√µes -->
      <div id="infoSidebar" class="sidebar" style="display: none;">
        <h3>Informa√ß√µes do Bloco</h3>
        <div class="info-item">
          <span class="info-label">CIDR:</span>
          <div class="info-value-container">
            <div id="sidebarBlockCidr" class="info-value">-</div>
            <button class="copy-btn" onclick="UIController.copiarTexto('sidebarBlockCidr')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Gateway padr√£o:</span>
          <div class="info-value-container">
            <div id="mainBlockGateway" class="info-value">-</div>
            <button class="copy-btn" onclick="UIController.copiarTexto('mainBlockGateway')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Google DNS</span>
          <div class="info-value-container">
            <div id="googleDNS" class="info-value">2001:4860:4860::8888</div>
            <button class="copy-btn" onclick="UIController.copiarTexto('googleDNS')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Google DNS Alt</span>
          <div class="info-value-container">
            <div id="googleDNSAlt" class="info-value">2001:4860:4860::8844</div>
            <button class="copy-btn" onclick="UIController.copiarTexto('googleDNSAlt')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Cloudflare DNS</span>
          <div class="info-value-container">
            <div id="cloudflareDNS" class="info-value">2606:4700:4700::1111</div>
            <button class="copy-btn" onclick="UIController.copiarTexto('cloudflareDNS')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>

        <!-- Conte√∫do para bloco agregado -->
        <div id="aggregatedContent" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-light);">
          <h3>Bloco Agregado</h3>
          <div class="info-item">
            <span class="info-label">Prefixo Agregado:</span>
            <div class="info-value-container">
              <div id="aggregatedPrefix" class="info-value">N/A</div>
              <button class="copy-btn" onclick="UIController.copiarTexto('aggregatedPrefix')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
          <p class="info-desc">Este √© o bloco IPv6 que engloba todas as sub-redes selecionadas, quando poss√≠vel realizar a agrega√ß√£o.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bot√µes de navega√ß√£o fixados -->
  <div class="nav-buttons">
    <button id="topBtn" class="nav-btn" title="Ir para o topo">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="bottomBtn" class="nav-btn" title="Ir para o final">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>
  
  <!-- SCRIPTS: Carregamento direto dos scripts na ordem correta -->
  <script src="js/core/ipv6-utils.js"></script>
  <script src="js/ui/ui-controller.js"></script>
  <script src="js/core/ipv6-calculator.js"></script>
  <script src="js/utils/env-check.js"></script>
  <script src="js/utils/debug-check.js"></script>
  <script src="js/ui/ui-components.js"></script>
  <script src="js/ui/responsive-handler.js"></script>
  <script src="js/ui/ui-fixes.js"></script>
  <script src="js/enhancements/enhanced-app.js"></script>
  <script src="js/core/app.js"></script>

  <!-- Biblioteca SheetJS (xlsx) para exporta√ß√£o Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- M√≥dulo de exporta√ß√£o Excel -->
  <script src="js/utils/excel-exporter.js"></script>
  <!-- Controlador de Exporta√ß√£o -->
  <script src="js/ui/export-controller.js"></script>
  
  <!-- Modal de Rede e Scripts de Sobreposi√ß√£o -->
  <script src="js/ui/overlap-checker.js"></script>
  <script src="js/ui/network-panel.js"></script>
  <script src="js/utils/modal-interactions.js"></script>
  <script src="js/overlap-integration.js"></script>

  <!-- Script de inicializa√ß√£o -->
  <script>
    // Script de inicializa√ß√£o para garantir que tudo est√° carregado corretamente
    document.addEventListener('DOMContentLoaded', function() {
      console.log("Verificando carregamento dos m√≥dulos...");
      
      // Verificar se os m√≥dulos principais foram carregados
      if (typeof IPv6Utils === 'undefined' || typeof UIController === 'undefined' || typeof IPv6Calculator === 'undefined') {
        // Mostrar erro de inicializa√ß√£o
        const errorAlert = document.getElementById('initErrorAlert');
        const errorMessage = document.getElementById('initErrorMessage');
        
        if (errorAlert && errorMessage) {
          errorMessage.textContent = "Alguns m√≥dulos necess√°rios n√£o foram carregados. Por favor, recarregue a p√°gina.";
          errorAlert.style.display = 'block';
        }
        
        console.error("Falha ao carregar os m√≥dulos necess√°rios!");
        console.log("IPv6Utils dispon√≠vel:", typeof IPv6Utils !== 'undefined');
        console.log("UIController dispon√≠vel:", typeof UIController !== 'undefined');
        console.log("IPv6Calculator dispon√≠vel:", typeof IPv6Calculator !== 'undefined');
        
        return;
      }
      
      // Configurar a fun√ß√£o global copiarTexto para compatibilidade
      if (typeof window.copiarTexto === 'undefined') {
        window.copiarTexto = UIController.copiarTexto;
        console.log("Fun√ß√£o global copiarTexto configurada");
      }
      
      console.log("Calculadora IPv6 inicializada com sucesso!");
    });
  </script>
</body>
</html>