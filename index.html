<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora IPv6 - Gerador de Sub-redes</title>
  <meta name="description" content="Ferramenta online para c√°lculo e visualiza√ß√£o de sub-redes IPv6">
  
  <!-- Favicon inline -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>" type="image/svg+xml">
  
  <!-- CSS - Ordem correta -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/dark-mode.css">
  <link rel="stylesheet" href="css/enhanced-ui.css">
  <link rel="stylesheet" href="css/ui-fixes.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Meta tags -->
  <meta name="theme-color" content="#0070d1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
  <!-- Alerta de erro -->
  <div id="initErrorAlert" style="display: none; background-color: #f8d7da; color: #721c24; padding: 12px; margin: 10px; border-radius: 4px; border: 1px solid #f5c6cb;">
    <strong>Erro ao inicializar:</strong> <span id="initErrorMessage"></span>
    <button onclick="window.location.reload()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; margin-left: 10px; border-radius: 3px; cursor: pointer;">Recarregar</button>
  </div>

  <div class="container">
    <!-- Cabe√ßalho -->
    <header class="header">
      <h1>Calculadora IPv6</h1>
      <div class="header-buttons">
        <button id="toggleThemeBtn" class="btn-primary">
          <i class="fas fa-moon"></i> Tema
        </button>
        <button id="resetBtn" class="btn-primary">
          <i class="fas fa-redo-alt"></i> Limpar
        </button>
      </div>
    </header>
    
    <!-- Indicador de passos -->
    <div class="steps">
      <div id="step1" class="step active">
        <div class="step-number">1</div>
        <div class="step-title">Inserir IPv6</div>
      </div>
      <div id="step2" class="step">
        <div class="step-number">2</div>
        <div class="step-title">Escolher Prefixo</div>
      </div>
      <div id="step3" class="step">
        <div class="step-number">3</div>
        <div class="step-title">Gerenciar Sub-redes</div>
      </div>
    </div>
    
    <!-- Layout principal -->
    <div class="main-layout">
      <div class="content">
        <!-- Formul√°rio inicial -->
        <div class="form-group">
          <label for="ipv6">Insira um endere√ßo IPv6 no formato CIDR:</label>
          <input type="text" id="ipv6" 
                 placeholder="Ex.: 2001:db8::/41" 
                 autocomplete="off" 
                 aria-describedby="errorMessage">
          <div id="errorMessage" class="error-message"></div>
          
          <div class="action-buttons">
            <button id="calcularBtn" class="btn-primary">
              <i class="fas fa-calculator"></i> Calcular Sub-redes
            </button>
          </div>
        </div>
        
        <!-- Bloco principal -->
        <div id="mainBlockSection" style="display: none;">
          <div class="card">
            <h3>Bloco IPv6 Principal</h3>
            <div class="info-item">
              <span class="info-label">CIDR:</span>
              <div class="info-value-container">
                <div id="mainBlockCidr" class="info-value">-</div>
                <button class="copy-btn" onclick="copyToClipboard(document.getElementById('mainBlockCidr'))">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            
            <div class="action-buttons">
              <button id="toggleMainBlockIpsBtn" class="btn-primary">
                <i class="fas fa-list"></i> Exibir IPs
              </button>
              <button id="continuarBtn" class="btn-secondary">
                <i class="fas fa-angle-right"></i> Escolher Prefixo
              </button>
            </div>
            
            <div id="mainBlockIpsContainer" style="display: none;">
              <h4>Primeiros IPs dispon√≠veis neste bloco:</h4>
              <ul id="mainBlockIpsList" class="ip-list"></ul>
              <div class="action-buttons">
                <button id="moreMainBlockIpsBtn" class="btn-primary">
                  <i class="fas fa-plus"></i> Gerar Mais 50 IPs
                </button>
                <button id="resetMainBlockIPsButton" class="btn-secondary">
                  <i class="fas fa-redo-alt"></i> Resetar Lista
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Sugest√µes de divis√£o -->
        <div id="suggestions" style="display: none;">
          <div class="card">
            <h3>Escolha um Prefixo para Divis√£o</h3>
            <p>Selecione o tamanho do prefixo para dividir o bloco em sub-redes:</p>
            <div id="possiblePrefixesList" class="prefixes-list"></div>
          </div>
        </div>
        
        <!-- Resultados -->
        <div id="resultado" style="display: none;">
          <div class="card">
            <h3>Sub-redes Geradas</h3>
            <div class="table-container">
              <table id="subnetsTable">
                <thead>
                  <tr>
                    <th width="50">
                      <input type="checkbox" id="selectAll" aria-label="Selecionar todas as sub-redes">
                    </th>
                    <th>Sub-rede</th>
                    <th>Inicial</th>
                    <th>Final</th>
                    <th>Rede</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            
            <div id="loadMoreContainer" style="display: none; text-align: center; margin-top: 16px;">
              <button id="loadMoreButton" class="btn-primary">
                <i class="fas fa-sync"></i> Carregar Mais Sub-redes
              </button>
            </div>
            
            <div class="action-buttons">
              <button id="gerarIPsButton" class="btn-primary" style="display: none;">
                <i class="fas fa-list"></i> Gerar IPs da Sub-rede
              </button>
            </div>
          </div>
        </div>
        
        <!-- Lista de IPs da sub-rede selecionada -->
        <div id="ipsResult" style="display: none;">
          <div class="card">
            <h3>IPs da Sub-rede Selecionada</h3>
            <ul id="ipsList" class="ip-list"></ul>
            <div class="action-buttons">
              <button id="gerarMaisIPsButton" class="btn-primary">
                <i class="fas fa-plus"></i> Gerar Mais 50 IPs
              </button>
              <button id="resetIPsButton" class="btn-secondary">
                <i class="fas fa-redo-alt"></i> Resetar Lista
              </button>
            </div>
          </div>
        </div>
        
        <!-- Indicador de carregamento -->
        <div id="loadingIndicator" class="loader-container" style="display: none;">
          <div class="loader"></div>
          <div class="loading-message">Gerando sub-redes... Por favor, aguarde.</div>
        </div>
      </div>
      
      <!-- Sidebar para informa√ß√µes -->
      <div id="infoSidebar" class="sidebar" style="display: none;">
        <h3>Informa√ß√µes do Bloco</h3>
        <div class="info-item">
          <span class="info-label">CIDR:</span>
          <div class="info-value-container">
            <div id="sidebarBlockCidr" class="info-value">-</div>
            <button class="copy-btn" onclick="copyToClipboard(document.getElementById('sidebarBlockCidr'))">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        <div class="info-item">
          <span class="info-label">Gateway padr√£o:</span>
          <div class="info-value-container">
            <div id="mainBlockGateway" class="info-value">-</div>
            <button class="copy-btn" onclick="copyToClipboard(document.getElementById('mainBlockGateway'))">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Google DNS</span>
          <div class="info-value-container">
            <div class="info-value">2001:4860:4860::8888</div>
            <button class="copy-btn" onclick="copyToClipboard('2001:4860:4860::8888')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Google DNS Alt</span>
          <div class="info-value-container">
            <div class="info-value">2001:4860:4860::8844</div>
            <button class="copy-btn" onclick="copyToClipboard('2001:4860:4860::8844')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="dns-item">
          <span class="dns-label">Cloudflare DNS</span>
          <div class="info-value-container">
            <div class="info-value">2606:4700:4700::1111</div>
            <button class="copy-btn" onclick="copyToClipboard('2606:4700:4700::1111')">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bot√µes de navega√ß√£o -->
  <div class="nav-buttons">
    <button id="topBtn" class="nav-btn" title="Ir para o topo">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="bottomBtn" class="nav-btn" title="Ir para o final">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>
  
  <!-- Scripts na ordem correta -->
  
  <!-- 1. Biblioteca externa primeiro -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- 2. Utilit√°rios base -->
  <script src="js/utils/ipv6-utils.js"></script>
  
  <!-- 3. Controladores principais -->
  <script src="js/core/ui-controller.js"></script>
  <script src="js/core/ipv6-calculator.js"></script>
  
  <!-- 4. Inicializa√ß√£o -->
  <script src="js/core/app.js"></script>

  <!-- Script de inicializa√ß√£o global -->
  <script>
    // Estado global da aplica√ß√£o
    window.appState = {
      subRedesGeradas: [],
      subRedesExibidas: 0,
      selectedBlock: null,
      currentIpOffset: 0,
      mainBlock: null,
      mainBlockCurrentOffset: 0,
      isMainBlockIpsVisible: false,
      currentStep: 1
    };
    
    // Fun√ß√£o global de c√≥pia
    function copyToClipboard(source) {
      let text;
      
      if (typeof source === 'string') {
        text = source;
      } else if (source && source.textContent) {
        text = source.textContent;
      } else if (source && source.innerText) {
        text = source.innerText;
      } else {
        console.error('Fonte inv√°lida para c√≥pia');
        return;
      }
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showNotification('Texto copiado!', 'success');
        }).catch(err => {
          console.error('Erro ao copiar:', err);
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }
    
    // Fun√ß√£o de c√≥pia fallback
    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        showNotification('Texto copiado!', 'success');
      } catch (err) {
        console.error('Falha ao copiar:', err);
        showNotification('Falha ao copiar texto', 'error');
      }
      
      document.body.removeChild(textArea);
    }
    
    // Fun√ß√£o de notifica√ß√£o simples
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 16px;
        border-radius: 6px;
        color: white;
        font-size: 14px;
        z-index: 10000;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        animation: slideIn 0.3s ease;
      `;
      
      const colors = {
        success: '#4caf50',
        error: '#f44336',
        warning: '#ff9800',
        info: '#2196f3'
      };
      
      notification.style.backgroundColor = colors[type] || colors.info;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease forwards';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }
    
    // Adicionar anima√ß√µes CSS
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    // Verifica√ß√£o de inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      console.log("üåê Calculadora IPv6 - Inicializa√ß√£o");
      
      // Verificar m√≥dulos cr√≠ticos
      const criticalModules = ['IPv6Utils', 'UIController', 'IPv6Calculator'];
      const missingModules = criticalModules.filter(module => typeof window[module] === 'undefined');
      
      if (missingModules.length > 0) {
        console.error("‚ùå M√≥dulos cr√≠ticos n√£o carregados:", missingModules);
        const errorAlert = document.getElementById('initErrorAlert');
        const errorMessage = document.getElementById('initErrorMessage');
        
        if (errorAlert && errorMessage) {
          errorMessage.textContent = `M√≥dulos n√£o carregados: ${missingModules.join(', ')}. Recarregue a p√°gina.`;
          errorAlert.style.display = 'block';
        }
        return;
      }
      
      console.log("‚úÖ Calculadora IPv6 inicializada com sucesso!");
    });
  </script>
</body>
</html>
